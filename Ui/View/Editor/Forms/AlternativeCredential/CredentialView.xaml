<UserControl x:Class="_1RM.View.Editor.Forms.AlternativeCredential.CredentialView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:controls="clr-namespace:_1RM.Controls"
             xmlns:alternativeCredential="clr-namespace:_1RM.View.Editor.Forms.AlternativeCredential"
             xmlns:s="https://github.com/canton7/Stylet"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance alternativeCredential:CredentialViewModel}"
             d:DesignHeight="450" d:DesignWidth="800">
    <StackPanel>
        <TextBlock Style="{StaticResource EditorGroupTextBlockTitle}" Text="TXT: PSW"></TextBlock>


        <Grid>
            <Rectangle StrokeDashArray="3" 
                       Margin="30 0 "
                       MinWidth="400"
                       Visibility="{Binding New.IsUserPswInheritedFromElseWhere, Converter={StaticResource ConverterBool2Visible}}" 
                       Stroke="{DynamicResource AccentMidBrush}" StrokeThickness="2" RadiusX="10" RadiusY="10"/>
            <StackPanel>

                <Grid Style="{StaticResource EditorRowGrid}" Visibility="{Binding New.IsUserPswInheritedFromElseWhere, Converter={StaticResource ConverterBool2Visible}}">
                    <Border BorderThickness="0 0 0 2"  
                            Margin="30 0 "
                            MinWidth="400">
                        <Border.BorderBrush>
                            <!--<SolidColorBrush Color="AliceBlue"></SolidColorBrush>-->
                            <VisualBrush>
                                <VisualBrush.Visual>
                                    <Rectangle StrokeDashArray="3 4" Stroke="{DynamicResource AccentMidBrush}" StrokeThickness="2"
                                               Width="{Binding RelativeSource={RelativeSource AncestorType={x:Type Border}}, Path=ActualWidth}"
                                               Height="{Binding RelativeSource={RelativeSource AncestorType={x:Type Border}}, Path=ActualHeight}"/>
                                </VisualBrush.Visual>
                            </VisualBrush>
                        </Border.BorderBrush>
                    </Border>


                    <StackPanel Orientation="Horizontal" Margin="0 15">
                        <TextBlock Style="{StaticResource EditorRowGridTitle}" Text="TXT: 使用凭据"></TextBlock>
                        <Grid Style="{StaticResource EditorRowGridInput}">
                            <ComboBox SelectedValuePath="Name" 
                                      DisplayMemberPath="Name" 
                                      SelectedItem="{Binding SelectedCredential}"
                                      ItemsSource="{Binding Credentials}"></ComboBox>
                        </Grid>
                    </StackPanel>
                </Grid>

                <Grid>
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource EditorRowGrid}">
                            <Setter Property="IsEnabled" Value="False"></Setter>
                            <Setter Property="Opacity" Value="0.5"></Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=SelectedCredential.Name}" Value="">
                                    <Setter Property="IsEnabled" Value="True"></Setter>
                                    <Setter Property="Opacity" Value="1"></Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Style="{StaticResource EditorRowGridTitle}" Text="{DynamicResource User}"></TextBlock>
                        <Grid Style="{StaticResource EditorRowGridInput}">
                            <TextBox Text="{Binding New.UserName, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnValidationError=True, ValidatesOnExceptions=True, ValidatesOnNotifyDataErrors=True}">
                            </TextBox>
                        </Grid>
                    </StackPanel>
                </Grid>


                <Grid Name="GridPwd">
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource EditorRowGrid}">
                            <Setter Property="Margin" Value="0"></Setter>
                            <Setter Property="IsEnabled" Value="False"></Setter>
                            <Setter Property="Opacity" Value="0.5"></Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding New.UsePrivateKeyForConnect}" Value="True">
                                    <Setter Property="Visibility" Value="Collapsed"></Setter>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Path=SelectedCredential.Name}" Value="">
                                    <Setter Property="IsEnabled" Value="True"></Setter>
                                    <Setter Property="Opacity" Value="1"></Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Style="{StaticResource EditorRowGridTitle}" Text="{DynamicResource Password}"></TextBlock>
                        <Grid Style="{StaticResource EditorRowGridInput}">
                            <controls:PasswordInput Height="32"
                                                    Tag="leave it blank and it will prompt for the password later."
                                                    Password="{Binding New.Password, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnValidationError=True, ValidatesOnExceptions=True, ValidatesOnNotifyDataErrors=True}">
                            </controls:PasswordInput>
                        </Grid>
                    </StackPanel>
                </Grid>

                <Grid Name="GridPrivateKey">
                    <Grid.Style>
                        <Style TargetType="Grid" BasedOn="{StaticResource EditorRowGrid}">
                            <Setter Property="Margin" Value="0"></Setter>
                            <Setter Property="IsEnabled" Value="False"></Setter>
                            <Setter Property="Opacity" Value="0.5"></Setter>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding New.UsePrivateKeyForConnect}" Value="False">
                                    <Setter Property="Visibility" Value="Collapsed"></Setter>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Path=SelectedCredential.Name}" Value="">
                                    <Setter Property="IsEnabled" Value="True"></Setter>
                                    <Setter Property="Opacity" Value="1"></Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Style="{StaticResource EditorRowGridTitle}" Text="{DynamicResource 'Private key'}"></TextBlock>
                            <Grid Style="{StaticResource EditorRowGridInput}" Height="32">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                    <ColumnDefinition Width="Auto"></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                                <TextBox Name="TbPrivateKey" Text="{Binding New.PrivateKey}"></TextBox>
                                <Button Grid.Column="1"
                                        Content="{DynamicResource Select}" 
                                        Click="{s:Action ButtonSelectPrivateKey_OnClick}" 
                                        Style="{StaticResource ButtonPrimaryStyle}"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Stretch">
                                </Button>
                            </Grid>
                            <TextBlock Style="{StaticResource TextBlockBase}" 
                                       VerticalAlignment="Center"
                                       Text="{DynamicResource 'Supports the Putty-key only'}" Opacity="0.7"></TextBlock>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <Grid Style="{StaticResource EditorRowGrid}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Style="{StaticResource EditorRowGridTitle}" Text=""></TextBlock>
                        <CheckBox Content="{DynamicResource 'Ask for password when open connect'}" IsChecked="{Binding New.AskPasswordWhenConnect}"></CheckBox>
                        <CheckBox Name="CbUsePrivateKey"
                                  Margin="5 0 0 0"
                                  Visibility="{Binding ShowPrivateKeyInput, Converter={StaticResource ConverterBool2Visible}}"
                                  IsChecked="{Binding New.UsePrivateKeyForConnect}"
                                  Content="{DynamicResource 'Use private key'}" ></CheckBox>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Grid>
        
    </StackPanel>
</UserControl>
