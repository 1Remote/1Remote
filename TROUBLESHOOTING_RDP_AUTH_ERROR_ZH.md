# RDP认证错误 0x80080005 故障排除指南

[English Version](TROUBLESHOOTING_RDP_AUTH_ERROR.md)

## 问题描述

如果您遇到RDP认证错误，显示以下消息：
```
An authentication error has occurred (Code: 0x80080005)
发生身份验证错误（代码：0x80080005）
```

此错误是由 **Windows 更新 KB5074109**（2026年1月13日发布）引起的，该更新在远程桌面身份验证中引入了一个漏洞。此问题影响系统范围内的多个RDP应用程序，而不仅仅是1Remote。

## 解决方案

### ✅ 推荐修复方法：安装微软补丁

微软已发布带外更新 **KB5077744**（2026年1月17日）来修复此问题。

#### 安装步骤：

1. **下载 KB5077744**：
   - 访问 [Microsoft Update Catalog](https://www.catalog.update.microsoft.com/Search.aspx?q=KB5077744)
   - 选择与您的Windows版本匹配的版本
   - 下载并安装更新

2. 安装后**重启计算机**

3. 在1Remote中**测试您的RDP连接**

#### 关于Windows更新的说明
这是一个影响范围有限的带外(OOB)更新，因此可能**不会自动出现**在Windows更新中。您需要从Microsoft Update Catalog手动安装。

## 替代临时解决方法

如果您暂时无法安装KB5077744：

### 方法1：RDP服务器端配置
如果您有权访问RDP服务器：
1. 临时调整身份验证要求
2. 使用限制较少的网络级身份验证(NLA)设置
3. ⚠️ **安全警告**：仅临时使用，因为这会降低安全性

### 方法2：使用替代连接协议
如果目标服务器支持：
1. 临时尝试使用VNC代替RDP
2. 为RDP连接使用SSH隧道

### 方法3：等待常规Windows更新
微软可能会在未来的月度更新周期中包含KB5077744，但这可能需要时间。

## 验证步骤

应用修复后：

1. **检查Windows更新历史记录**：
   - 打开 设置 → Windows更新 → 更新历史记录
   - 验证KB5077744已安装

2. **测试RDP连接**：
   - 打开1Remote
   - 尝试连接RDP会话
   - 连接应该成功，不会出现身份验证错误

## 其他信息

### 为什么会发生这种情况
- Windows安全更新KB5074109在CredSSP(凭据安全支持提供程序)中引入了一个漏洞
- CredSSP是RDP客户端使用的身份验证协议
- 该漏洞影响各种应用程序的RDP身份验证

### 为什么不同用户看到不同的行为
- 有些用户可能尚未安装KB5074109
- 不同的Windows配置可能表现出不同的症状
- 系统特定因素(域成员身份、组策略等)会影响表现

### 关于v1.2.1版本的说明
有些用户报告v1.2.1版本可以正常工作，这可能是因为：
1. 测试时尚未安装KB5074109
2. 系统配置差异
3. 时间因素：在KB5074109和KB5077744之间的窗口期

**经过详细的代码分析，确认1Remote在v1.2.0和当前版本之间没有与认证相关的代码更改。**

## 参考资料

- **原始问题**: [#1056](https://github.com/1Remote/1Remote/issues/1056)
- **完整技术调查报告**: [INVESTIGATION_ISSUE_1056.md](INVESTIGATION_ISSUE_1056.md)
- **微软 KB5074109**: [2026年1月安全更新](https://support.microsoft.com/zh-cn/topic/january-13-2026-kb5074109)
- **微软 KB5077744 (修复)**: [带外更新](https://support.microsoft.com/zh-cn/topic/january-17-2026-kb5077744-os-builds-26200-7627-and-26100-7627-out-of-band-27015658-9686-4467-ab5f-d713b617e3e4)

## 仍然有问题？

如果您已安装KB5077744但仍然遇到问题：

1. **验证更新已安装**：
   ```powershell
   Get-HotFix | Where-Object {$_.HotFixID -eq "KB5077744"}
   ```

2. **检查Windows版本**：
   - KB5077744适用于Windows 11版本24H2和23H2
   - 确保您的Windows版本受支持

3. **报告问题**：
   - 如果安装KB5077744后问题仍然存在，这可能是不同的问题
   - 在GitHub上打开新问题，并提供详细信息：
     - Windows版本和内部版本号
     - 确认已安装KB5077744
     - 完整的错误消息和日志

## 系统管理员须知

### 组策略考虑因素
如果管理多个系统：
1. 通过WSUS或Configuration Manager部署KB5077744
2. 首先在暂存环境中测试
3. 监控身份验证日志中的问题

### 安全建议
- **不要禁用CredSSP**作为解决方法(安全风险)
- **不要降级**到较旧的Windows更新(安全风险)
- **尽快安装KB5077744**以保持安全性和功能性

---

**最后更新**: 2026年1月22日  
**适用于**: 1Remote所有版本，已安装KB5074109的Windows 11
